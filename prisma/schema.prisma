generator client {
    provider = "prisma-client"
    output   = "../generated/prisma"
}

datasource db {
    provider = "mysql"
}

model RefreshToken {
    id        Int      @id @default(autoincrement())
    token     String   @unique
    expires   DateTime
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    valid     Boolean  @default(true)
    
    user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId    Int

    @@index([userId])
}

model User {
    id        Int        @id @default(autoincrement())
    email     String     @unique
    password  String
    callsigns Callsign[]
    createdAt DateTime   @default(now())
    updatedAt DateTime   @updatedAt
    verified  Boolean    @default(false)
    admin     Boolean    @default(false)
    emailToken String?    @unique
    emailTokenExpires DateTime?
    emailVerified Boolean   @default(false)
    refreshTokens RefreshToken[]
}

model Callsign {
    id           Int            @id @default(autoincrement())
    callsign     String         @unique
    operatorName String?
    
    licenseClass String?
    licenseType  String?
    status       CallsignStatus
    
    addressLine1 String?
    addressLine2 String?
    city         String?
    stateProvince String?
    postalCode   String?
    country      String

    ituZone      Int?

    regulatoryBody String?
    
    gridSquare   String?
    createdAt    DateTime       @default(now())
    updatedAt    DateTime       @updatedAt

    userId      Int?
    user        User?          @relation(fields: [userId], references: [id])
    views       Int            @default(0)

    qsos        QSO[]          @relation("CallsignToQSO")
    
    @@index([userId])
    @@index([country])
    @@index([gridSquare])
}

model QSO {
    id          Int        @id @default(autoincrement())
    userId      Int
    timestamp   DateTime   @default(now())  // when the contact happened
    callsignId  Int         // the local/our callsign
    contactCallsign String  // the callsign you contacted
    contactGrid   String?     // grid square of the contacted station
    mode        String?     // e.g., SSB, CW, FT8
    frequency   Float?      // in MHz
    band        String?     // e.g., 20m, 40m
    rstSent     String?     // signal report sent
    rstReceived String?     // signal report received
    qslSent     Boolean     @default(false)
    qslReceived Boolean     @default(false)
    notes       String?     // optional notes
    createdAt   DateTime    @default(now())
    updatedAt   DateTime    @updatedAt

    callsign    Callsign    @relation("CallsignToQSO", fields: [callsignId], references: [id])

    @@index([callsignId])
    @@index([contactCallsign])
    @@index([timestamp])
}


enum CallsignStatus {
    ACTIVE
    EXPIRED
    SUSPENDED
    CANCELLED
    REVOKED
}